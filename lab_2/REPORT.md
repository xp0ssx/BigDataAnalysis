# Отчет по лабораторной работе №2

## Описание проекта
В данной лабораторной работе был реализован ETL-процесс с использованием Apache Spark для трансформации данных из исходных CSV файлов в модель "звезда" в PostgreSQL, а затем создание витрин данных в ClickHouse для аналитики.

## Структура проекта
```
lab_2/
├── docker-compose.yml          # Конфигурация Docker-контейнеров
├── docker-entrypoint-initdb.d/ # Скрипты инициализации БД
├── notebooks/                  # Jupyter notebooks с ETL-процессами
│   ├── create_datamarts.ipynb # Создание витрин данных
│   └── etl_process.ipynb      # ETL из CSV в PostgreSQL
└── README.md                  # Описание проекта
```

## Этапы выполнения работы

### 1. Подготовка инфраструктуры
1. Создан `docker-compose.yml` с необходимыми сервисами:
   - PostgreSQL для хранения данных в модели "звезда"
   - ClickHouse для хранения витрин данных
   - Jupyter Notebook с PySpark для ETL-процессов

### 2. ETL-процесс в PostgreSQL
1. Загрузка данных из CSV-файлов
2. Создание таблиц измерений:
   - `dim_customer` (1000 записей)
   - `dim_product` (1000 записей)
   - `dim_store` (383 записи)
   - `dim_supplier` (383 записи)
   - `dim_date` (364 записи)
3. Создание таблицы фактов:
   - `fact_sales` (10,000 записей)

### 3. Создание витрин данных в ClickHouse
Созданы следующие витрины:

1. **Витрина продаж по продуктам** (`product_sales`):
   - Топ-10 самых продаваемых продуктов
   - Общая выручка по категориям
   - Средний рейтинг и отзывы

2. **Витрина продаж по клиентам** (`customer_sales`):
   - Топ-10 клиентов по сумме покупок
   - Распределение по странам
   - Средний чек

3. **Витрина продаж по времени** (`time_sales`):
   - Месячные и годовые тренды
   - Сравнение выручки по периодам
   - Средний размер заказа

4. **Витрина продаж по магазинам** (`store_sales`):
   - Топ-5 магазинов по выручке
   - Распределение по городам
   - Средний чек

5. **Витрина продаж по поставщикам** (`supplier_sales`):
   - Топ-5 поставщиков по выручке
   - Средние цены товаров
   - Распределение по странам

6. **Витрина качества продукции** (`product_quality`):
   - Рейтинги продуктов
   - Корреляция рейтинга и продаж
   - Анализ отзывов

## Инструкция по запуску

### Предварительные требования
- Docker и Docker Compose
- Git

### Шаги по запуску

1. Запуск контейнеров:
```bash
docker-compose up -d
```

2. Проверка статуса контейнеров:
```bash
docker-compose ps
```

3. Доступ к Jupyter Notebook:
   - Откройте в браузере: http://localhost:8888
   - Токен доступа можно найти в логах контейнера:
     ```bash
     docker logs jupyter
     ```

4. Выполнение ETL-процесса:
   - Откройте `notebooks/etl_process.ipynb`
   - Выполните все ячейки последовательно
   - Проверьте создание таблиц в PostgreSQL

5. Создание витрин данных:
   - Откройте `notebooks/create_datamarts.ipynb`
   - Выполните все ячейки последовательно
   - Проверьте создание витрин в ClickHouse

### Проверка результатов

1. Подключение к PostgreSQL:
```bash
psql -h localhost -p 5433 -U postgres -d pet_store_lab_2
```

2. Подключение к ClickHouse:
```bash
clickhouse-client --host localhost --port 8123 --user default --password clickhouse
```

## Результаты анализа данных

### Основные выводы:
1. Наиболее продаваемые товары:
   - Cat Toy (84 единицы)
   - Dog Food (80 единиц)
   - Bird Cage (78 единиц)

2. Топ клиенты:
   - Mile Tuer (Иордания) - 4,005.98
   - Lewiss Pinshon (Китай) - 3,784.44
   - Alexis Quinton (Китай) - 3,751.09

3. Сезонность продаж:
   - Пик продаж в октябре (228,743.32)
   - Спад в декабре (191,368.86)
   - Стабильный средний чек в течение года

4. Эффективность магазинов:
   - Лидер - Mynte (Китай) с выручкой 15,751.71
   - Высокая концентрация успешных магазинов в Китае и Чехии

5. Поставщики:
   - Лидер - Wikizz (Узбекистан) с выручкой 17,729.73
   - Стабильное качество продукции (рейтинги 2.86-3.21)

## Заключение
ETL-процесс успешно реализован с использованием Apache Spark. Созданные витрины данных позволяют проводить разносторонний анализ бизнес-показателей и принимать обоснованные решения на основе данных. 